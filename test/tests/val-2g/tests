[Tests]
  design = 'TrappingNodalKernel.md ReleasingNodalKernel.md'
  issues = '#349'
  validation = 'val-2g.md'
  # Light tests (fast, coarse mesh)
  [val-2g_no_trapping_light_csv]
    type = CSVDiff
    input = val-2g_no_trapping_initial_parameters.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_no_trapping_light_out"
    csvdiff = val-2g_no_trapping_light_out.csv
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics without trapping effects to generate CSV data for use in comparisons with the experimental data.'
  []
  [val-2g_no_trapping_light_exodus]
    type = Exodiff
    input = val-2g_no_trapping_initial_parameters.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_no_trapping_light_out"
    exodiff = val-2g_no_trapping_light_out.e
    prereq = val-2g_no_trapping_light_csv
    should_execute = false # this test relies on the output files from val-2g_no_trapping_light_csv, so it shouldn't be run twice
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics without trapping effects.'
  []
  [val-2g_trapping_initial_light_csv]
    type = CSVDiff
    input = val-2g_trapping_initial_parameters.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_trapping_initial_light_out"
    csvdiff = val-2g_trapping_initial_light_out.csv
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects to generate CSV data for use in comparisons with the experimental data.'
  []
  [val-2g_trapping_initial_light_exodus]
    type = Exodiff
    input = val-2g_trapping_initial_parameters.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_trapping_initial_light_out"
    exodiff = val-2g_trapping_initial_light_out.e
    prereq = val-2g_trapping_initial_light_csv
    should_execute = false # this test relies on the output files from val-2g_trapping_initial_light_csv, so it shouldn't be run twice
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects.'
  []
  [val-2g_trapping_calibrated_light_csv]
    type = CSVDiff
    input = val-2g_trapping_calibrated.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_trapping_calibrated_light_out"
    csvdiff = val-2g_trapping_calibrated_light_out.csv
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects using calibrated parameters to generate CSV data for use in comparisons with the experimental data.'
  []
  [val-2g_trapping_calibrated_light_exodus]
    type = Exodiff
    input = val-2g_trapping_calibrated.i
    cli_args = "edge_number=10 num_nodes=30 dissolve_duration='${units 60 s}' cooldown_duration='${units 60 s}' Outputs/file_base=val-2g_trapping_calibrated_light_out"
    exodiff = val-2g_trapping_calibrated_light_out.e
    prereq = val-2g_trapping_calibrated_light_csv
    should_execute = false # this test relies on the output files from val-2g_trapping_calibrated_light_csv, so it shouldn't be run twice
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects using calibrated parameters.'
  []
  # Heavy tests
  [val-2g_no_trapping_csv]
    type = CSVDiff
    input = val-2g_no_trapping_initial_parameters.i
    csvdiff = val-2g_no_trapping_initial_parameters_csv.csv
    heavy = true
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics without trapping effects under fine mesh and time step to generate CSV data output.'
  []
  [val-2g_trapping_initial_csv]
    type = CSVDiff
    input = val-2g_trapping_initial_parameters.i
    csvdiff = val-2g_trapping_initial_parameters_csv.csv
    heavy = true
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects under fine mesh and time step to generate CSV data output.'
  []
  [val-2g_trapping_calibrated_csv]
    type = CSVDiff
    input = val-2g_trapping_calibrated.i
    csvdiff = val-2g_trapping_calibrated_csv.csv
    heavy = true
    requirement = 'The system shall be able to model deuterium transport in proton-conducting ceramics with trapping effects using calibrated parameters under fine mesh and time step to generate CSV data output.'
  []
  # PSS optimization test (short run)
  [val-2g_pss_optimization]
    type = JSONDiff
    input = val-2g_main_PSS_trapping.i
    jsondiff = val-2g_PSS/both_cases_trapping.json
    abs_zero = 1e-8
    rel_err = 1e-5
    max_parallel = 1
    recover = false
    heavy = true
    requirement = 'The system shall be able to perform a Parallel Subset Simulation optimization study for deuterium transport in proton-conducting ceramics.'
  []
  # Comparison script test
  [val-2g_comparison]
    type = RunCommand
    command = 'python3 comparison_val-2g.py'
    requirement = 'The system shall be able to generate comparison plots between simulated solutions and experimental data of validation case val-2g, modeling deuterium transport in proton-conducting ceramics.'
    required_python_packages = 'matplotlib numpy pandas scipy'
  []
[]
